<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üìä Imported Trades - Visual Trade Copilot</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: linear-gradient(180deg, #1a1a2e, #0f0f1e);
  color: #ffd700;
  font-family: 'Segoe UI', system-ui, sans-serif;
  padding: 20px;
  min-height: 100vh;
}

.container {
  max-width: 1400px;
  margin: 0 auto;
}

h1 {
  text-align: center;
  margin-bottom: 30px;
  font-size: 2.5em;
  text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.stat-card {
  background: rgba(42, 42, 42, 0.8);
  padding: 20px;
  border-radius: 12px;
  border: 2px solid rgba(255, 215, 0, 0.3);
  text-align: center;
}

.stat-value {
  font-size: 2em;
  font-weight: bold;
  margin: 10px 0;
}

.stat-label {
  font-size: 0.9em;
  opacity: 0.8;
}

.profit { color: #00ff88; }
.loss { color: #ff4444; }

.filters {
  background: rgba(42, 42, 42, 0.8);
  padding: 20px;
  border-radius: 12px;
  margin-bottom: 20px;
  display: flex;
  gap: 15px;
  flex-wrap: wrap;
  align-items: center;
}

.filters label {
  font-weight: 600;
}

.filters select, .filters input {
  background: #1a1a2e;
  color: #ffd700;
  border: 1px solid rgba(255, 215, 0, 0.3);
  padding: 8px 12px;
  border-radius: 6px;
  font-size: 14px;
}

table {
  width: 100%;
  background: rgba(42, 42, 42, 0.8);
  border-radius: 12px;
  overflow: hidden;
  border-collapse: collapse;
}

thead {
  background: rgba(255, 215, 0, 0.1);
}

th, td {
  padding: 15px;
  text-align: left;
  border-bottom: 1px solid rgba(255, 215, 0, 0.1);
}

th {
  font-weight: 600;
  text-transform: uppercase;
  font-size: 0.85em;
  letter-spacing: 0.5px;
}

tbody tr:hover {
  background: rgba(255, 215, 0, 0.05);
}

.badge {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 0.85em;
  font-weight: 600;
}

.badge-long {
  background: rgba(0, 255, 136, 0.2);
  color: #00ff88;
}

.badge-short {
  background: rgba(255, 68, 68, 0.2);
  color: #ff4444;
}

.btn {
  background: #ffd700;
  color: #111;
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);
}

.loading {
  text-align: center;
  padding: 50px;
  font-size: 1.2em;
}
</style>
</head>
<body>
<div class="container">
  <h1>üìä Imported Trades</h1>
  
  <div class="stats-grid" id="statsGrid">
    <div class="stat-card">
      <div class="stat-label">Total Trades</div>
      <div class="stat-value" id="totalTrades">-</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Win Rate</div>
      <div class="stat-value" id="winRate">-</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Total P&L</div>
      <div class="stat-value" id="totalPnl">-</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Avg P&L</div>
      <div class="stat-value" id="avgPnl">-</div>
    </div>
  </div>

  <div class="filters">
    <label>Symbol:</label>
    <select id="symbolFilter">
      <option value="">All Symbols</option>
    </select>
    
    <label>Direction:</label>
    <select id="directionFilter">
      <option value="">All</option>
      <option value="long">Long</option>
      <option value="short">Short</option>
    </select>
    
    <label>Outcome:</label>
    <select id="outcomeFilter">
      <option value="">All</option>
      <option value="win">Wins</option>
      <option value="loss">Losses</option>
    </select>
    
    <button class="btn" onclick="loadTrades()">üîÑ Refresh</button>
  </div>

  <div id="content">
    <div class="loading">Loading trades...</div>
  </div>
</div>

<script>
let allTrades = [];

async function loadTrades() {
  try {
    const response = await fetch('http://127.0.0.1:8765/trades/imported?limit=100');
    const data = await response.json();
    allTrades = data.trades;
    
    // Update stats
    const wins = allTrades.filter(t => (t.pnl || 0) > 0).length;
    const losses = allTrades.filter(t => (t.pnl || 0) < 0).length;
    const totalPnl = allTrades.reduce((sum, t) => sum + (t.pnl || 0), 0);
    const avgPnl = totalPnl / allTrades.length;
    const winRate = (wins / allTrades.length) * 100;
    
    document.getElementById('totalTrades').textContent = allTrades.length;
    document.getElementById('winRate').textContent = winRate.toFixed(1) + '%';
    document.getElementById('winRate').className = 'stat-value ' + (winRate >= 50 ? 'profit' : 'loss');
    document.getElementById('totalPnl').textContent = '$' + totalPnl.toFixed(2);
    document.getElementById('totalPnl').className = 'stat-value ' + (totalPnl >= 0 ? 'profit' : 'loss');
    document.getElementById('avgPnl').textContent = '$' + avgPnl.toFixed(2);
    document.getElementById('avgPnl').className = 'stat-value ' + (avgPnl >= 0 ? 'profit' : 'loss');
    
    // Populate symbol filter
    const symbols = [...new Set(allTrades.map(t => t.symbol))].sort();
    const symbolFilter = document.getElementById('symbolFilter');
    symbolFilter.innerHTML = '<option value="">All Symbols</option>';
    symbols.forEach(sym => {
      const option = document.createElement('option');
      option.value = sym;
      option.textContent = sym;
      symbolFilter.appendChild(option);
    });
    
    renderTrades();
  } catch (error) {
    document.getElementById('content').innerHTML = 
      '<div class="loading">‚ùå Error loading trades: ' + error.message + '</div>';
  }
}

function renderTrades() {
  const symbolFilter = document.getElementById('symbolFilter').value;
  const directionFilter = document.getElementById('directionFilter').value;
  const outcomeFilter = document.getElementById('outcomeFilter').value;
  
  let filtered = allTrades.filter(t => {
    if (symbolFilter && t.symbol !== symbolFilter) return false;
    if (directionFilter && t.direction !== directionFilter) return false;
    if (outcomeFilter) {
      if (outcomeFilter === 'win' && t.pnl <= 0) return false;
      if (outcomeFilter === 'loss' && t.pnl >= 0) return false;
    }
    return true;
  });
  
  let html = `
    <table>
      <thead>
        <tr>
          <th>Symbol</th>
          <th>Direction</th>
          <th>Entry</th>
          <th>Exit</th>
          <th>P&L</th>
          <th>Contracts</th>
          <th>Duration</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody>
  `;
  
  filtered.forEach(trade => {
    const pnlClass = trade.pnl > 0 ? 'profit' : 'loss';
    const dirClass = trade.direction === 'long' ? 'badge-long' : 'badge-short';
    
    html += `
      <tr>
        <td><strong>${trade.symbol}</strong></td>
        <td><span class="badge ${dirClass}">${trade.direction.toUpperCase()}</span></td>
        <td>$${(trade.entry_price || 0).toFixed(2)}</td>
        <td>$${(trade.exit_price || 0).toFixed(2)}</td>
        <td class="${pnlClass}"><strong>$${(trade.pnl || 0).toFixed(2)}</strong></td>
        <td>${trade.contracts || 0}</td>
        <td>${trade.duration || 'N/A'}</td>
        <td>${trade.trade_day.split(' ')[0]}</td>
      </tr>
    `;
  });
  
  html += '</tbody></table>';
  
  if (filtered.length === 0) {
    html = '<div class="loading">No trades match the current filters.</div>';
  }
  
  document.getElementById('content').innerHTML = html;
}

// Event listeners
document.getElementById('symbolFilter').addEventListener('change', renderTrades);
document.getElementById('directionFilter').addEventListener('change', renderTrades);
document.getElementById('outcomeFilter').addEventListener('change', renderTrades);

// Load on page load
loadTrades();
</script>
</body>
</html>

